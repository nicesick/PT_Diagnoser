<!DOCTYPE html>
<html xmlns:th="http://wwww.thymeleaf.org">
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
    <meta name="description" content="" />
    <meta name="author" content="" />

    <title>SB Admin 2 - Dashboard</title>

    <!-- Custom fonts for this template-->
    <link href="vendor/fontawesome-free/css/all.min.css" rel="stylesheet" type="text/css" />
    <link href="https://fonts.googleapis.com/css?family=Nunito:200,200i,300,300i,400,400i,600,600i,700,700i,800,800i,900,900i" rel="stylesheet" />

    <!-- Custom styles for this template-->
    <link href="css/sb-admin-2.min.css" rel="stylesheet" />
</head>

<div>

<!-- Page Wrapper -->
<div id="wrapper">
    <!-- Content Wrapper -->
    <div id="content-wrapper" class="d-flex flex-column">
        <!-- Main Content -->
        <div id="content">
            <!-- Begin Page Content -->
            <div class="container-fluid">

                <!-- Page Heading -->
                <div class="d-sm-flex align-items-center justify-content-between mb-2">
                    <h1 class="h3 text-gray-800"><span th:text="${result[0].user_id}"></span>님의 PT역량 결과입니다.</h1>
                </div>

                <div th:if='${"".equals(result[0].data[0].workDtim)}'>
                    검사결과가 없습니다.
                </div>
                <div th:unless='${"".equals(result[0].data[0].workDtim)}'>
                    <div class="row mb-3">
                        <div class="col-sm-12 col-md-6">
                            <!-- Rader Chart -->
                            <div class="card shadow mb-4 h-100">
                                <div class="card-header py-3">
                                    <div class="row">
                                        <div class="col-12">
                                            <div class="dropdown">
                                                <button class="btn btn-primary btn-block dropdown-toggle" type="button" id="dropdownMenuButton" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                                    <span id="current-workDtim"></span>
                                                </button>
                                                <div class="dropdown-menu w-100" aria-labelledby="dropdownMenuButton">
                                                    <!--<a class="dropdown-item" href="#">Action</a>
                                                    <a class="dropdown-item" href="#">Another action</a>
                                                    <a class="dropdown-item" href="#">Something else here</a>-->
                                                    <div th:each="data : ${result[0].data}">
                                                        <a class="text-center dropdown-item dropdown-workDtim" th:text="${data.workDtim}"></a>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="card-body mb-4">
                                    <div class="chart-bar">
                                        <canvas id="mainChart"></canvas>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-sm-12 col-md-6">
                            <!-- Horizontal Bar Chart -->
                            <div class="card shadow mb-4 h-100">
                                <div class="card-header py-3">
                                    <div class="row">
                                        <div class="col-12">
                                            <h6 class="font-weight-bold text-primary">점검결과</h6>
                                        </div>
                                    </div>
                                </div>
                                <div class="card-body mb-4">
                                    <div th:each="title : ${result[0].data[0].title}">
                                        <div class="row">
                                            <div class="col-12">
                                                <div>
                                                    <canvas th:attr="id=|barChart_${title}|" height="37"></canvas>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-12">
                            <div class="card shadow h-100">
                                <div class="card-header py-3">
                                    <div class="row">
                                        <div class="col-12">
                                            <h6 class="font-weight-bold text-primary">교육과정</h6>
                                        </div>
                                    </div>
                                </div>
                                <div class="card-body mb-4">
                                    teest
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <!-- /.container-fluid -->
        </div>
        <!-- End of Main Content -->
    </div>
    <!-- End of Content Wrapper -->
</div>
    <!-- Bootstrap core JavaScript-->
    <script src="vendor/jquery/jquery.min.js"></script>
    <script src="vendor/bootstrap/js/bootstrap.bundle.min.js"></script>

    <!-- Core plugin JavaScript-->
    <script src="vendor/jquery-easing/jquery.easing.min.js"></script>

    <!-- Custom scripts for all pages-->
    <script src="js/sb-admin-2.min.js"></script>

    <!-- Page level plugins -->
    <script src="vendor/chart.js/Chart.min.js"></script>

<!-- End of Page Wrapper -->
    <script th:inline="javascript">
        var resultSet = /*[[${result}]]*/;
        var radarChart;
        var barCharts;

        /**
         * 처음 페이지 초기화
         */
        $(document).ready(function(){
            console.log(resultSet);

            if (resultSet[0].data[0].workDtim != "") {
                $('.dropdown-workDtim:first').trigger('click');
            }
        });

        /**
         * Button Event
         *
         * .dropdown-workDtim.click
         */
        $('.dropdown-workDtim').click(function(){
            var targetWorkDtim = $(this).text();

            console.log(targetWorkDtim);

            var targetWorkDtimTitle = findTitle(targetWorkDtim);
            var targetWorkDtimScore = findScore(targetWorkDtim);

            /*
             * dropdown 현행화
             */
            $('#current-workDtim').text(targetWorkDtim);

            /*
             * 차트 현행화
             */
            if (radarChart != null) {
                radarChart.destroy();
            }

            if (barCharts != null) {
                $(barCharts).each(function(index, barChart){
                    barChart.destroy();
                });
            }

            radarChart = createRadarChart(targetWorkDtimTitle, targetWorkDtimScore);
            barCharts = [];

            $(targetWorkDtimTitle).each(function(index) {
                barCharts.push(createHorizontalBarChart(targetWorkDtimTitle[index], targetWorkDtimScore[index]));
            });
        });

        /**
         * Utils
         *
         * findTitle
         * findScore
         */
        function findTitle(workDtim) {
            var title;

            $(resultSet[0].data).each(function(index, data){
                if (data.workDtim == workDtim) {
                    title = data.title;
                    return;
                }
            });

            return title;
        }

        function findScore(workDtim) {
            var score;

            $(resultSet[0].data).each(function(index, data){
                if (data.workDtim == workDtim) {
                    score = data.score;
                    return;
                }
            });

            return score;
        }

        /**
         * createCharts
         *
         * createRaderChart
         * createHorizontalBarChart
         */
        function createRadarChart(title, score) {
            var chart = new Chart($('#mainChart'), {
                type    : 'radar',
                data    : {
                    labels : title,
                    datasets : [{
                        fill : false,
                        backgroundColor : 'rgba(200, 0, 0, 0.2)',
                        pointRadius : 5,
                        pointHoverRadius : 7,
                        data : score
                    }]
                },
                options : {
                    legend : {
                        display : false
                    },
                    scale : {
                        ticks : {
                            beginAtZero : true,
                            min : 0,
                            max : 100,
                            stepSize : 20
                        }
                    }
                }
            });

            return chart;
        }

        function createHorizontalBarChart(title, score) {
            var chart = new Chart($('#barChart_' + title), {
                type : 'horizontalBar',
                data : {
                    labels : [title],
                    datasets : [{
                        fill : false,
                        backgroundColor : ['rgba(255, 99, 132, 0.2)'],
                        borderColor : ['rgb(255, 159, 64)'],
                        data : [score]
                    }]
                },
                options : {
                    legend : {
                        display : false
                    },
                    scales : {
                        xAxes : [{
                            ticks : {
                                beginAtZero : true,
                                min : 0,
                                max : 100,
                                stepSize : 20
                            }
                        }],
                        yAxes : [{
                            afterFit: function(scaleInstance) {
                                scaleInstance.width = 150; // sets the width to 100px
                            }
                        }]
                    }
                }
            });

            return chart;
        }
    </script>
</div>
</html>
